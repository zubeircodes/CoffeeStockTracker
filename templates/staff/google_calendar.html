{% extends 'base.html' %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Google Calendar View</h1>
        <div>
            <a href="{{ url_for('staff.create_shift') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add Shift
            </a>
            <a href="{{ url_for('staff.shift_calendar') }}" class="btn btn-outline-secondary ms-2">
                <i class="fas fa-calendar-alt"></i> Standard Calendar
            </a>
            <a href="{{ url_for('staff.staff_list') }}" class="btn btn-outline-secondary ms-2">
                <i class="fas fa-users"></i> Staff Directory
            </a>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="card-title">Google Calendar Integration</h5>
                    <p class="card-text">
                        This view displays the integrated Google Calendar. All staff shifts are synchronized with Google Calendar.
                    </p>
                    
                    <!-- Google Calendar iframe embed -->
                    <div class="embed-responsive" style="height: 600px;">
                        <iframe id="google-calendar-frame" 
                                src="https://calendar.google.com/calendar/embed?src=primary&ctz=local&mode=WEEK&showPrint=0&showTabs=1&showCalendars=0&showTitle=0" 
                                style="border: 0; width: 100%; height: 100%;" 
                                frameborder="0" 
                                scrolling="no">
                        </iframe>
                    </div>
                    
                    <!-- Instructions for users -->
                    <div class="alert alert-info mt-3">
                        <h5><i class="fas fa-info-circle"></i> Calendar Integration</h5>
                        <p>This calendar display requires Google authentication. If you don't see your calendar:</p>
                        <ol>
                            <li>Make sure you're signed in to your Google account</li>
                            <li>Check that the calendar service is properly connected</li>
                            <li>Use the "Shift Calendar" view from the menu for a local calendar view</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card shadow">
                <div class="card-header">
                    <h5>Upcoming Events</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Event</th>
                                    <th>Start Time</th>
                                    <th>End Time</th>
                                    <th>Location</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if events %}
                                    {% for event in events %}
                                    <tr>
                                        <td>{{ event.summary }}</td>
                                        <td>
                                            {% if event.start.dateTime %}
                                                {{ event.start.dateTime|string|replace('T', ' ')|replace('Z', '')|truncate(16, True, '') }}
                                            {% elif event.start.date %}
                                                {{ event.start.date }} (All day)
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if event.end.dateTime %}
                                                {{ event.end.dateTime|string|replace('T', ' ')|replace('Z', '')|truncate(16, True, '') }}
                                            {% elif event.end.date %}
                                                {{ event.end.date }} (All day)
                                            {% endif %}
                                        </td>
                                        <td>{{ event.location|default('N/A', true) }}</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="4" class="text-center">No upcoming events found</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add any JavaScript you need for the Google Calendar view here
    });
</script>
{% endblock %}